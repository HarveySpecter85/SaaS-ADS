---
phase: 05-asset-gallery
plan: 03
type: execute
depends_on: ["05-02"]
files_modified: [src/app/api/assets/export/route.ts, src/components/export-modal.tsx, src/app/(dashboard)/gallery/client.tsx, src/lib/export-utils.ts]
---

<objective>
Create the export workflow with platform-specific bundles.

Purpose: Enable users to export selected assets as packages formatted for specific ad platforms.
Output: Export modal, platform bundle generation API, and download functionality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-asset-gallery/05-CONTEXT.md
@.planning/phases/05-asset-gallery/05-02-SUMMARY.md

**From CONTEXT.md - Vision:**
- Platform-specific export bundles (Google Ads, Meta, TikTok) with correct dimensions/formats
- No manual resizing or format conversion
- Select assets and get a package ready for upload

**Platform requirements:**
- Google Ads: 1200x628 (landscape), 1080x1080 (square), 300x250 (medium rectangle)
- Meta: 1080x1080 (feed), 1080x1920 (story), 1200x628 (link ad)
- TikTok: 1080x1920 (vertical), 1920x1080 (horizontal)

**From 05-02 (selection available):**
- Selected asset IDs tracked in gallery state
- Floating action bar with Export button
- Assets have image_url, width, height, format

**Constraints:**
- Client-side image resizing for simplicity (Canvas API)
- ZIP generation in browser (JSZip library)
- Alternative: Server-side export API that returns ZIP
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create export utilities and platform specs</name>
  <files>src/lib/export-utils.ts</files>
  <action>
Create src/lib/export-utils.ts:

Define platform specifications:
```typescript
export const PLATFORM_SPECS = {
  google_ads: {
    name: 'Google Ads',
    formats: [
      { name: 'Landscape', width: 1200, height: 628 },
      { name: 'Square', width: 1080, height: 1080 },
      { name: 'Medium Rectangle', width: 300, height: 250 },
    ]
  },
  meta: {
    name: 'Meta (Facebook/Instagram)',
    formats: [
      { name: 'Feed Square', width: 1080, height: 1080 },
      { name: 'Story', width: 1080, height: 1920 },
      { name: 'Link Ad', width: 1200, height: 628 },
    ]
  },
  tiktok: {
    name: 'TikTok',
    formats: [
      { name: 'Vertical', width: 1080, height: 1920 },
      { name: 'Horizontal', width: 1920, height: 1080 },
    ]
  }
};
```

Utility functions:
- `resizeImage(imageUrl: string, width: number, height: number): Promise<Blob>` - Use Canvas API to resize
- `generateFilename(assetId: string, platform: string, format: string): string` - Consistent naming
- `downloadBlob(blob: Blob, filename: string)` - Trigger browser download

For resizing: Use object-fit: cover equivalent logic (crop to fill, center)

NOTE: JSZip will be added in Task 2 for bundle creation.
  </action>
  <verify>npm run build succeeds, utility functions compile</verify>
  <done>Platform specs defined, resize and download utilities ready</done>
</task>

<task type="auto">
  <name>Task 2: Create export modal component</name>
  <files>src/components/export-modal.tsx</files>
  <action>
Create src/components/export-modal.tsx:

Modal for configuring and triggering export:

**Header:**
- "Export {N} Assets" title
- Close button (X)

**Platform selection:**
- Three large platform cards: Google Ads, Meta, TikTok
- Each shows platform icon/logo placeholder
- Click to select (single or multi-select)
- Selected platforms highlighted

**Format options (per platform):**
- When platform selected, show its available formats
- Checkboxes for each format (default: all checked)
- Shows dimensions next to each format name

**Export options:**
- Output format: PNG (recommended) or JPG (smaller file size)
- Quality slider for JPG (80% default)

**Preview summary:**
- "{X} assets Ã— {Y} formats = {Z} total files"
- Estimated size (rough calculation)

**Actions:**
- "Export" button (primary, disabled until platform selected)
- "Cancel" button (secondary)

**Export process:**
1. On Export click, show progress indicator
2. For each selected asset:
   - For each selected platform/format combination:
     - Resize image to target dimensions
     - Add to ZIP bundle (one ZIP per platform)
3. Download ZIP file(s)
4. Show success message with download count

Install JSZip: `npm install jszip` and `npm install -D @types/jszip`

Style: Modal with clear sections. Visual platform cards. Progress feedback.
  </action>
  <verify>npm run build succeeds, modal renders and accepts selections</verify>
  <done>Export modal allows platform selection and format configuration</done>
</task>

<task type="auto">
  <name>Task 3: Integrate export modal into gallery</name>
  <files>src/app/(dashboard)/gallery/client.tsx</files>
  <action>
Update GalleryClient to integrate export:

**Wire up export button:**
- Floating action bar "Export" button opens ExportModal
- Pass selected asset IDs to modal
- Pass asset data (image URLs, existing dimensions) to modal

**Export flow:**
1. User selects assets in gallery
2. Clicks "Export" in floating action bar
3. ExportModal opens with selection context
4. User picks platforms and formats
5. Export generates and downloads ZIP(s)
6. Modal closes, selection cleared (optional)
7. Success toast notification

**Handle export completion:**
- Show toast: "Exported {N} files to {platform}"
- Option to clear selection after export
- Keep modal open if error occurs

**Loading states:**
- Disable gallery interaction during export
- Show progress in modal (X of Y files processed)
- Cancel button during export (aborts operation)

Error handling:
- If image fails to load: Skip and note in final summary
- If ZIP generation fails: Show error, don't download partial
- Network errors: Retry prompt or skip
  </action>
  <verify>npm run build succeeds, export workflow completes end-to-end</verify>
  <done>Export workflow works from selection to ZIP download</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Export modal opens from floating action bar
- [ ] Platform and format selection works
- [ ] Export generates resized images
- [ ] ZIP downloads with correct file structure
- [ ] No TypeScript or ESLint errors
- [ ] Phase 5 complete
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Platform specs correctly define ad dimensions
- Export modal provides clear configuration options
- ZIP bundles contain correctly resized images
- Download workflow is smooth and provides feedback
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-asset-gallery/05-03-SUMMARY.md`

Commit guidance:
- Task 1: `feat(05-03): create export utilities and platform specs`
- Task 2: `feat(05-03): create export modal component`
- Task 3: `feat(05-03): integrate export workflow into gallery`
- Metadata: `docs(05-03): complete export workflow plan`

Note: This is the final plan for Phase 5. After SUMMARY.md, update ROADMAP.md and STATE.md to mark Phase 5 complete.
</output>
