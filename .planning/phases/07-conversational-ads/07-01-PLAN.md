---
phase: 07-conversational-ads
plan: 01
type: execute
depends_on: []
files_modified: [src/components/chat-widget.tsx, src/components/chat-bubble.tsx, src/components/chat-message.tsx, src/app/(dashboard)/chat/page.tsx]
---

<objective>
Create the chat widget UI component (Intercom-style floating bubble).

Purpose: Build the visual chat interface that visitors will use to engage in product discovery conversations.
Output: Floating chat bubble component, expandable chat panel, message display components, demo page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-conversational-ads/07-CONTEXT.md

**From CONTEXT.md - Vision:**
- Widget-style chat UI (floating bubble, expands on click, like Intercom)
- Chat-first landing pages for product discovery
- Feels like talking to a knowledgeable sales assistant

**UI Patterns from prior phases:**
- Modal overlay pattern (export-modal.tsx) - fixed positioning, z-index layering
- Server/Client Component split for interactivity
- Tailwind styling with focus rings and hover states

**Tech stack available:**
- Next.js 14+ with App Router
- Tailwind CSS for styling
- React state management (useState, useCallback)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create chat message components</name>
  <files>src/components/chat-message.tsx</files>
  <action>
Create src/components/chat-message.tsx:

```typescript
// Chat message component with sender differentiation

interface ChatMessageProps {
  role: 'user' | 'assistant';
  content: string;
  timestamp?: Date;
  isLoading?: boolean;  // For streaming indicator
}

export function ChatMessage({ role, content, timestamp, isLoading }: ChatMessageProps)
```

**Implementation:**
- User messages: Right-aligned, primary color background (blue-600)
- Assistant messages: Left-aligned, gray background (gray-100)
- Avatar: Small circle icon (user icon vs bot icon)
- Loading state: Three dots animation for streaming
- Timestamp: Optional, small gray text below message
- Max width: ~70% of container
- Text: break-words for long content
- Rounded corners: rounded-2xl with tail on appropriate side

**Styling:**
- User: `bg-blue-600 text-white ml-auto`
- Assistant: `bg-gray-100 text-gray-900 mr-auto`
- Container: `flex gap-2 items-end`
  </action>
  <verify>npm run build succeeds, component exports correctly</verify>
  <done>ChatMessage component renders user and assistant messages distinctly</done>
</task>

<task type="auto">
  <name>Task 2: Create chat bubble and expandable panel</name>
  <files>src/components/chat-bubble.tsx, src/components/chat-widget.tsx</files>
  <action>
1. Create src/components/chat-bubble.tsx:

```typescript
// Floating action button that opens the chat

interface ChatBubbleProps {
  isOpen: boolean;
  onClick: () => void;
  hasUnread?: boolean;
}

export function ChatBubble({ isOpen, onClick, hasUnread }: ChatBubbleProps)
```

**Implementation:**
- Fixed position: bottom-6 right-6
- Size: 56x56px (w-14 h-14)
- Shape: rounded-full
- Color: Primary blue with white icon
- Icon: Message icon when closed, X icon when open
- Unread indicator: Small red dot (absolute positioned)
- Hover: Scale up slightly (scale-105)
- Transition: Smooth icon rotation on open/close
- Shadow: shadow-lg for depth
- Z-index: z-50

2. Create src/components/chat-widget.tsx:

```typescript
// Complete chat widget with bubble + panel

'use client';

interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: Date;
}

interface ChatWidgetProps {
  brandId?: string;       // For brand-aware responses
  initialMessage?: string; // Welcome message
}

export function ChatWidget({ brandId, initialMessage }: ChatWidgetProps)
```

**Implementation:**
- State: isOpen, messages[], inputValue, isLoading
- Panel: Fixed position, bottom-24 right-6 (above bubble)
- Panel size: w-96 h-[500px] (or max-h-[70vh])
- Panel styling: bg-white rounded-2xl shadow-2xl
- Header: Brand name or "Chat with us", close button
- Messages area: flex-1 overflow-y-auto p-4
- Input area: Fixed bottom, border-t, input + send button
- Animation: Slide up when opening (transform translate-y)
- Mobile: Full screen on small screens (sm:w-96 sm:h-[500px])

**Input handling:**
- Textarea with auto-resize (or input)
- Send on Enter (without shift)
- Send button with arrow icon
- Disabled when empty or loading

**Initial state:**
- Show initialMessage as first assistant message
- Default: "Hi! I'm here to help you find the perfect product. What are you looking for today?"
  </action>
  <verify>npm run build succeeds, widget renders and toggles correctly</verify>
  <done>Chat bubble toggles panel, messages display, input works</done>
</task>

<task type="auto">
  <name>Task 3: Create chat demo page</name>
  <files>src/app/(dashboard)/chat/page.tsx</files>
  <action>
Create src/app/(dashboard)/chat/page.tsx:

```typescript
// Demo page for testing the chat widget

export default function ChatPage() {
  return (
    <div className="min-h-screen">
      {/* Page header */}
      <div className="p-8">
        <h1>Conversational Ads Demo</h1>
        <p>Test the chat widget - click the bubble in the bottom right</p>
      </div>

      {/* Demo content simulating a landing page */}
      <div className="p-8 space-y-8">
        <section>Featured Products placeholder</section>
        <section>About Us placeholder</section>
      </div>

      {/* Chat widget */}
      <ChatWidget
        initialMessage="Hi! I'm here to help you discover products. What are you looking for?"
      />
    </div>
  );
}
```

**Implementation:**
- Simple landing page mockup
- Chat widget rendered at page level
- Shows widget is self-contained and non-intrusive
- Demonstrates the Intercom-style overlay pattern

**For now:** Widget is UI-only (no backend). Typing a message just echoes it back or shows "Connecting..." - actual Gemini integration comes in Plan 02.
  </action>
  <verify>npm run build succeeds, /chat page renders with working widget UI</verify>
  <done>Demo page shows chat widget in action, UI is complete</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] ChatMessage component renders both user and assistant styles
- [ ] ChatBubble shows floating button, toggles state
- [ ] ChatWidget opens/closes panel smoothly
- [ ] Messages display in scrollable area
- [ ] Input field works (type, send on enter)
- [ ] /chat demo page accessible
- [ ] Mobile responsive (full-screen on small screens)
- [ ] No TypeScript or ESLint errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Chat widget is visually complete (Intercom-style)
- Widget is self-contained component
- Ready for backend integration in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/07-conversational-ads/07-01-SUMMARY.md`

Commit guidance:
- Task 1: `feat(07-01): create chat message component`
- Task 2: `feat(07-01): create chat bubble and widget panel`
- Task 3: `feat(07-01): create chat demo page`
- Metadata: `docs(07-01): complete chat widget UI plan`
</output>
